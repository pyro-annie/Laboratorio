<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="{{ url_for('static', filename='python.ico') }}">
    <meta charset="UTF-8">
    <title>Página de Registro e Inicio de Sesión</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>
<body>
    <section class="login-page">
        <section class="form">
            <form class="register-form" style="display:none;" id="register-form">
                <label for="name">Nombre de Usuario</label>
                <input type="text" id="name" placeholder="Nombre de Usuario" required/>             
                <label for="password">Contraseña</label>
                <input type="password" id="password" placeholder="Contraseña" required/>    
                <label for="phone">Número de Teléfono</label>
                <input id="phone" type="tel" name="phone" />
                <div class="alert alert-info" style="display: none;"></div>
                <label for="email">Correo Electrónico</label>
                <input type="email" id="email" placeholder="Correo Electrónico" pattern="^[a-zA-Z0-9._%+-]+@(gmail\.com|outlook\.com)$" title="Ingresa un correo de Gmail o Outlook válido." required/>                     
                <button type="button" id="create_account_btn">Crear</button>
                <button type="button" id="generate_password_btn">Generar Contraseña Segura</button>              
                <p class="message">¿Ya estás registrado? <a href="#" onclick="showLoginForm()">Iniciar sesión</a></p>
            </form>           
            <form class="login-form" id="login-form">
                <label for="username">Nombre de Usuario</label>
                <input type="text" name="username" placeholder="Nombre de Usuario" required/>              
                <label for="login-password">Contraseña</label>
                <input type="password" name="password" placeholder="Contraseña" required/>             
                <button type="submit">Iniciar</button>    
                <p class="message">¿No estás registrado? <a href="#" onclick="showRegisterForm()">Crea tu cuenta</a></p>
                <p><a href="{{ url_for('forgot_account') }}">Olvidaste tu contraseña?</a></p>
            </form>
        </section>
    </section>   
    <script>
        const phoneInputField = document.querySelector("#phone");
        const phoneInput = window.intlTelInput(phoneInputField, {
          utilsScript:
            "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });
        const info = document.querySelector(".alert-info");

function process(event) {
 event.preventDefault();

 const phoneNumber = phoneInput.getNumber();

 info.style.display = "";
 info.innerHTML = `Phone number in E.164 format: <strong>${phoneNumber}</strong>`;
}

      </script> 
    <script>
    function showNotification(message, type) {
        Swal.fire({
            icon: type,
            title: type === 'error' ? 'Error' : 'Éxito',
            text: message,
            timer: 3000
        });
    }
    
    function showRegisterForm() {
        $('.login-form').hide();
        $('.register-form').show();
    }
    
    function showLoginForm() {
        $('.register-form').hide();
        $('.login-form').show();
    }
    
    $('#generate_password_btn').click(function() {
        $.post('/generate-password', function(data) {
            $('#password').val(data.password).attr('type', 'text');
            setTimeout(function() {
                $('#password').attr('type', 'password');
            }, 10000);
            showNotification('Contraseña generada con éxito', 'success');
        });
    });
    
    $('#create_account_btn').click(function() {
        var name = $('#name').val().trim();
        var password = $('#password').val().trim();
        var phone = phoneInput.getNumber();
        var email = $('#email').val().trim();
    
        if (!phoneInput.isValidNumber()) {
            showNotification('Por favor, ingresa un número de teléfono válido.', 'error');
            return;
        }
    
        $.post('/register', {name: name, password: password, phone: phone, email: email}, function(data) {
            showNotification(data.message, 'success');
            showLoginForm();
        }).fail(function(jqXHR) {
            showNotification(jqXHR.responseJSON.error, 'error');
        });
    });
    
    
    $('#login-form').submit(function(event) {
        event.preventDefault();
        var username = $('input[name="username"]').val().trim();
        var password = $('input[name="password"]').val().trim();
        $.ajax({
            url: '/login',
            type: 'POST',
            data: {username: username, password: password},
            success: function(data) {
                showNotification(data.message, 'success');
            },
            error: function(jqXHR) {
                showNotification(jqXHR.responseJSON.error, 'error');
            }
        });
    });
    </script>
    
</body>
</html>
