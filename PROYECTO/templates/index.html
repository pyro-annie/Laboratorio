<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="{{ url_for('static', filename='python.ico') }}">
    <meta charset="UTF-8">
    <title>Página de Registro e Inicio de Sesión</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>
<body>
    <section class="login-page">
        <section class="form">
            <form class="register-form" style="display:none;" id="register-form">
                <label for="name">Nombre de Usuario</label>
                <input type="text" id="name" placeholder="Nombre de Usuario" required/>             
                <label for="password">Contraseña</label>
                <input type="password" id="password" placeholder="Contraseña" required/>            
                <button type="button" id="create_account_btn">Crear</button>
                <button type="button" id="generate_password_btn">Generar Contraseña Segura</button>              
                <p class="message">¿Ya estás registrado? <a href="#" onclick="showLoginForm()">Iniciar sesión</a></p>
            </form>           
            <form class="login-form" id="login-form">
                <label for="username">Nombre de Usuario</label>
                <input type="text" name="username" placeholder="Nombre de Usuario" required/>              
                <label for="login-password">Contraseña</label>
                <input type="password" name="password" placeholder="Contraseña" required/>             
                <button type="submit">Iniciar</button>                          
                <p class="message">¿No estás registrado? <a href="#" onclick="showRegisterForm()">Crea tu cuenta</a></p>
            </form>
        </section>
    </section>    
    <script>
    function showNotification(message, type) {
        Swal.fire({
            icon: type,
            title: type === 'error' ? 'Error' : 'Éxito',
            text: message,
            timer: 3000
        });
    }
    
    function showRegisterForm() {
        $('.login-form').hide();
        $('.register-form').show();
    }
    
    function showLoginForm() {
        $('.register-form').hide();
        $('.login-form').show();
    }
    
    $('#generate_password_btn').click(function() {
        $.post('/generate-password', function(data) {
            $('#password').val(data.password).attr('type', 'text');
            setTimeout(function() {
                $('#password').attr('type', 'password');
            }, 10000);
            showNotification('Contraseña generada con éxito', 'success');
        });
    });
    
    $('#create_account_btn').click(function() {
        var name = $('#name').val().trim();
        var password = $('#password').val().trim();
        $.post('/register', {name: name, password: password}, function(data) {
            showNotification(data.message, 'success');
            showLoginForm();
        }).fail(function(jqXHR) {
            showNotification(jqXHR.responseJSON.error, 'error');
        });
    });
    
    $('#login-form').submit(function(event) {
        event.preventDefault();
        var username = $('input[name="username"]').val().trim();
        var password = $('input[name="password"]').val().trim();
        $.ajax({
            url: '/login',
            type: 'POST',
            data: {username: username, password: password},
            success: function(data) {
                showNotification(data.message, 'success');
            },
            error: function(jqXHR) {
                showNotification(jqXHR.responseJSON.error, 'error');
            }
        });
    });
    </script>
    
</body>
</html>
  